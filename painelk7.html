<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - Logix Express</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #f8f9fa;
            color: #333;
        }

        .admin-header {
            background: linear-gradient(135deg, #345C7A, #2c4a63);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .admin-header .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-title {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-nav {
            background: white;
            padding: 15px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .nav-buttons {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav-button {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            color: #495057;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-button:hover {
            background: #e9ecef;
            border-color: #345C7A;
        }

        .nav-button.active {
            background: #345C7A;
            color: white;
            border-color: #345C7A;
        }

        .admin-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .admin-view {
            display: none;
        }

        .admin-view.active {
            display: block;
        }

        .view-header {
            margin-bottom: 30px;
        }

        .view-title {
            font-size: 2rem;
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .view-description {
            color: #666;
            font-size: 1.1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #345C7A;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #345C7A;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .bulk-import-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .bulk-import-instructions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #345C7A;
        }

        .bulk-import-instructions h4 {
            color: #345C7A;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .bulk-textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-family: monospace;
            font-size: 13px;
            line-height: 1.4;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .bulk-textarea:focus {
            outline: none;
            border-color: #345C7A;
            box-shadow: 0 0 0 3px rgba(52, 92, 122, 0.1);
        }

        .bulk-controls {
            margin: 20px 0;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-button {
            background: #345C7A;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .control-button:hover {
            background: #2c4a63;
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(52, 92, 122, 0.3);
        }

        .control-button.danger {
            background: #e74c3c;
        }

        .control-button.danger:hover {
            background: #c0392b;
        }

        .control-button.success {
            background: #27ae60;
        }

        .control-button.success:hover {
            background: #229954;
        }

        .control-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .preview-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #345C7A;
        }

        .preview-section h4 {
            color: #345C7A;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .preview-controls {
            margin-top: 15px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .preview-summary {
            color: #666;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .results-section {
            margin-top: 30px;
            padding: 20px;
            background: #e8f5e8;
            border-radius: 8px;
            border: 2px solid #27ae60;
        }

        .results-section h4 {
            color: #27ae60;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .leads-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .table-header {
            background: #345C7A;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .leads-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .table-content {
            padding: 20px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 20px;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #999;
        }

        .empty-state p {
            font-size: 1rem;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .admin-header .container {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .nav-buttons {
                justify-content: center;
            }

            .bulk-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .control-button {
                justify-content: center;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .admin-view {
            animation: fadeIn 0.3s ease;
        }
    </style>
</head>
<body>
    <!-- Admin Header -->
    <header class="admin-header">
        <div class="container">
            <h1 class="admin-title">
                <i class="fas fa-cog"></i>
                Painel Administrativo - Logix Express
            </h1>
            <div class="admin-info">
                <span>Sistema de Gest√£o de Leads</span>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="admin-nav">
        <div class="nav-buttons">
            <button class="nav-button active" id="showLeadsView">
                <i class="fas fa-list"></i> Lista de Leads
            </button>
            <button class="nav-button" id="showAddLeadView">
                <i class="fas fa-plus"></i> Adicionar Lead
            </button>
            <button class="nav-button" id="showBulkAddView">
                <i class="fas fa-upload"></i> Importa√ß√£o em Massa
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="admin-content">
        <!-- Leads View -->
        <div id="leadsView" class="admin-view active">
            <div class="view-header">
                <h2 class="view-title">
                    <i class="fas fa-users"></i>
                    Gerenciamento de Leads
                </h2>
                <p class="view-description">
                    Visualize e gerencie todos os leads do sistema
                </p>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalLeadsCount">0</div>
                    <div class="stat-label">Total de Leads</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="pendingPaymentsCount">0</div>
                    <div class="stat-label">Aguardando Pagamento</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completedLeadsCount">0</div>
                    <div class="stat-label">Entregas Conclu√≠das</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="todayLeadsCount">0</div>
                    <div class="stat-label">Leads de Hoje</div>
                </div>
            </div>

            <!-- Leads Table -->
            <div class="leads-table">
                <div class="table-header">
                    <h3 class="table-title">
                        <i class="fas fa-table"></i>
                        Lista de Leads
                    </h3>
                    <div class="leads-count" id="leadsCount">0 leads</div>
                </div>
                <div class="table-content">
                    <div class="empty-state" id="emptyState">
                        <i class="fas fa-inbox"></i>
                        <h3>Nenhum lead encontrado</h3>
                        <p>Comece importando leads em massa ou adicione um lead manualmente.</p>
                    </div>
                    <div id="leadsTableContainer" style="display: none;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: #f8f9fa; border-bottom: 2px solid #e9ecef;">
                                    <th style="padding: 12px; text-align: left; font-weight: 600; color: #495057;">Nome</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; color: #495057;">CPF</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; color: #495057;">Email</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; color: #495057;">Telefone</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; color: #495057;">Produto</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; color: #495057;">Valor</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; color: #495057;">Data</th>
                                </tr>
                            </thead>
                            <tbody id="leadsTableBody">
                                <!-- Leads ser√£o inseridos aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Lead View -->
        <div id="addLeadView" class="admin-view">
            <div class="view-header">
                <h2 class="view-title">
                    <i class="fas fa-user-plus"></i>
                    Adicionar Novo Lead
                </h2>
                <p class="view-description">
                    Adicione um novo lead manualmente ao sistema
                </p>
            </div>

            <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);">
                <form id="addLeadForm">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">Nome Completo *</label>
                            <input type="text" id="leadName" required style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">CPF *</label>
                            <input type="text" id="leadCPF" required maxlength="14" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">Email</label>
                            <input type="email" id="leadEmail" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">Telefone</label>
                            <input type="tel" id="leadPhone" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;">
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">Produto</label>
                        <input type="text" id="leadProduct" value="Kit 12 caixas organizadoras + brinde" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;">
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">Valor Total</label>
                            <input type="number" id="leadValue" step="0.01" value="67.90" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">Meio de Pagamento</label>
                            <select id="leadPaymentMethod" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;">
                                <option value="PIX">PIX</option>
                                <option value="Cart√£o">Cart√£o</option>
                                <option value="Boleto">Boleto</option>
                            </select>
                        </div>
                    </div>

                    <div style="margin-bottom: 30px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">Endere√ßo Completo</label>
                        <textarea id="leadAddress" rows="3" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem; resize: vertical;"></textarea>
                    </div>

                    <button type="submit" class="control-button success" style="font-size: 1rem; padding: 15px 30px;">
                        <i class="fas fa-save"></i> Salvar Lead
                    </button>
                </form>
            </div>
        </div>

        <!-- Bulk Import View -->
        <div id="bulkAddView" class="admin-view">
            <div class="view-header">
                <h2 class="view-title">
                    <i class="fas fa-upload"></i>
                    Importa√ß√£o em Massa
                </h2>
                <p class="view-description">
                    Importe m√∫ltiplos leads de uma s√≥ vez colando dados da planilha
                </p>
            </div>

            <div class="bulk-import-section">
                <div class="bulk-import-instructions">
                    <h4><i class="fas fa-info-circle"></i> Instru√ß√µes de Importa√ß√£o</h4>
                    <p><strong>Cole os dados da planilha diretamente no campo abaixo.</strong></p>
                    <p>Formato esperado (separado por TAB):</p>
                    <div style="background: #fff; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; overflow-x: auto; border: 1px solid #ddd; margin: 10px 0;">
                        Nome&nbsp;&nbsp;&nbsp;&nbsp;Email&nbsp;&nbsp;&nbsp;&nbsp;Telefone&nbsp;&nbsp;&nbsp;&nbsp;CPF&nbsp;&nbsp;&nbsp;&nbsp;Produto&nbsp;&nbsp;&nbsp;&nbsp;Valor&nbsp;&nbsp;&nbsp;&nbsp;Endere√ßo&nbsp;&nbsp;&nbsp;&nbsp;N√∫mero&nbsp;&nbsp;&nbsp;&nbsp;Complemento&nbsp;&nbsp;&nbsp;&nbsp;Bairro&nbsp;&nbsp;&nbsp;&nbsp;CEP&nbsp;&nbsp;&nbsp;&nbsp;Cidade&nbsp;&nbsp;&nbsp;&nbsp;Estado&nbsp;&nbsp;&nbsp;&nbsp;Pa√≠s
                    </div>
                    <p><strong>Campos obrigat√≥rios:</strong> Nome, Email, Telefone, CPF</p>
                </div>
                
                <textarea 
                    id="bulkDataTextarea" 
                    class="bulk-textarea" 
                    placeholder="Cole aqui os dados copiados da planilha...

Exemplo:
Jo√£o Silva Santos	joao@email.com	5511999999999	12345678901	Kit Produto	47.39	Rua das Flores	123	Apto 1	Centro	01234567	S√£o Paulo	SP	BR
Maria Costa	maria@email.com	5511888888888	98765432100	Kit Produto	71.86	Av. Paulista	456		Bela Vista	01310100	S√£o Paulo	SP	BR">
                </textarea>
                
                <div class="bulk-controls">
                    <button id="previewBulkDataButton" class="control-button">
                        <i class="fas fa-eye"></i> An√°lise Inteligente
                    </button>
                    <button id="clearBulkDataButton" class="control-button danger">
                        <i class="fas fa-trash"></i> Limpar Dados
                    </button>
                    <div style="background: #fff3cd; padding: 10px; border-radius: 6px; flex: 1; border: 1px solid #ffeaa7;">
                        <p style="margin: 0; font-size: 0.8rem; color: #856404;">
                            <i class="fas fa-lightbulb"></i> 
                            Cole os dados e clique em "An√°lise Inteligente" para verificar os campos
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Preview Section -->
            <div id="bulkPreviewSection" class="preview-section" style="display: none;">
                <h4><i class="fas fa-table"></i> Pr√©-visualiza√ß√£o dos Dados</h4>
                <div id="bulkPreviewContainer">
                    <!-- Tabela de pr√©-visualiza√ß√£o ser√° inserida aqui -->
                </div>
                <div class="preview-controls">
                    <button id="confirmBulkImportButton" class="control-button success" style="display: none;">
                        <i class="fas fa-rocket"></i> Confirmar Importa√ß√£o
                    </button>
                    <button id="editBulkDataButton" class="control-button">
                        <i class="fas fa-edit"></i> Editar Dados
                    </button>
                    <span id="previewSummary" class="preview-summary">
                        <!-- Resumo ser√° inserido aqui -->
                    </span>
                </div>
            </div>
            
            <!-- Results Section -->
            <div id="bulkResultsSection" class="results-section" style="display: none;">
                <h4><i class="fas fa-chart-bar"></i> Progresso da Importa√ß√£o</h4>
                <div id="bulkResultsContainer">
                    <!-- Progresso e resultados ser√£o inseridos aqui -->
                </div>
            </div>
        </div>
    </main>

    <script type="module">
        // Sistema de administra√ß√£o simplificado
        class AdminPanel {
            constructor() {
                this.leads = [];
                this.bulkImportData = [];
                this.init();
            }

            async init() {
                console.log('üéõÔ∏è Inicializando painel administrativo');
                this.setupEventListeners();
                await this.loadLeads();
                this.updateStats();
            }

            setupEventListeners() {
                // Navega√ß√£o
                document.getElementById('showLeadsView')?.addEventListener('click', () => {
                    this.showView('leadsView');
                });
                document.getElementById('showAddLeadView')?.addEventListener('click', () => {
                    this.showView('addLeadView');
                });
                document.getElementById('showBulkAddView')?.addEventListener('click', () => {
                    this.showView('bulkAddView');
                });

                // Formul√°rio de adicionar lead
                document.getElementById('addLeadForm')?.addEventListener('submit', (e) => {
                    this.handleAddLead(e);
                });

                // Importa√ß√£o em massa
                document.getElementById('previewBulkDataButton')?.addEventListener('click', () => {
                    this.previewBulkData();
                });
                document.getElementById('clearBulkDataButton')?.addEventListener('click', () => {
                    this.clearBulkData();
                });
                document.getElementById('confirmBulkImportButton')?.addEventListener('click', () => {
                    this.confirmBulkImport();
                });
                document.getElementById('editBulkDataButton')?.addEventListener('click', () => {
                    this.editBulkData();
                });

                // M√°scara de CPF
                document.getElementById('leadCPF')?.addEventListener('input', (e) => {
                    this.applyCPFMask(e.target);
                });
            }

            showView(viewId) {
                // Ocultar todas as views
                document.querySelectorAll('.admin-view').forEach(view => {
                    view.classList.remove('active');
                });

                // Remover classe active de todos os bot√µes
                document.querySelectorAll('.nav-button').forEach(btn => {
                    btn.classList.remove('active');
                });

                // Mostrar view selecionada
                const view = document.getElementById(viewId);
                if (view) {
                    view.classList.add('active');
                }

                // Ativar bot√£o correspondente
                const buttonMap = {
                    'leadsView': 'showLeadsView',
                    'addLeadView': 'showAddLeadView',
                    'bulkAddView': 'showBulkAddView'
                };
                const button = document.getElementById(buttonMap[viewId]);
                if (button) {
                    button.classList.add('active');
                }

                // Atualizar dados se for a view de leads
                if (viewId === 'leadsView') {
                    this.updateLeadsDisplay();
                }
            }

            async loadLeads() {
                try {
                    this.leads = JSON.parse(localStorage.getItem('leads') || '[]');
                    console.log(`üìä ${this.leads.length} leads carregados`);
                } catch (error) {
                    console.error('‚ùå Erro ao carregar leads:', error);
                    this.leads = [];
                }
            }

            updateStats() {
                const totalLeads = this.leads.length;
                const pendingPayments = this.leads.filter(lead => {
                    const stage = lead.etapa_atual || 1;
                    const status = lead.status_pagamento || 'pendente';
                    return (stage === 11 && status === 'pendente') || stage === 16 || stage === 106 || stage === 116 || stage === 126;
                }).length;
                const completedLeads = this.leads.filter(lead => (lead.etapa_atual || 1) >= 17).length;
                const todayLeads = this.leads.filter(lead => {
                    const today = new Date().toDateString();
                    const leadDate = new Date(lead.created_at).toDateString();
                    return today === leadDate;
                }).length;

                document.getElementById('totalLeadsCount').textContent = totalLeads;
                document.getElementById('pendingPaymentsCount').textContent = pendingPayments;
                document.getElementById('completedLeadsCount').textContent = completedLeads;
                document.getElementById('todayLeadsCount').textContent = todayLeads;
                document.getElementById('leadsCount').textContent = `${totalLeads} leads`;
            }

            updateLeadsDisplay() {
                const tableContainer = document.getElementById('leadsTableContainer');
                const emptyState = document.getElementById('emptyState');
                const tableBody = document.getElementById('leadsTableBody');

                if (this.leads.length === 0) {
                    tableContainer.style.display = 'none';
                    emptyState.style.display = 'block';
                    return;
                }

                emptyState.style.display = 'none';
                tableContainer.style.display = 'block';

                tableBody.innerHTML = this.leads.slice(0, 50).map(lead => `
                    <tr style="border-bottom: 1px solid #e9ecef;">
                        <td style="padding: 12px; color: #495057;">${lead.nome_completo || 'N/A'}</td>
                        <td style="padding: 12px; color: #495057;">${this.formatCPF(lead.cpf || '')}</td>
                        <td style="padding: 12px; color: #495057;">${lead.email || 'N/A'}</td>
                        <td style="padding: 12px; color: #495057;">${lead.telefone || 'N/A'}</td>
                        <td style="padding: 12px; color: #495057;" title="${lead.produto || 'N/A'}">${this.truncateText(lead.produto || 'N/A', 30)}</td>
                        <td style="padding: 12px; color: #495057;">R$ ${(lead.valor_total || 0).toFixed(2)}</td>
                        <td style="padding: 12px; color: #495057;">${this.formatDate(lead.created_at)}</td>
                    </tr>
                `).join('');

                if (this.leads.length > 50) {
                    tableBody.innerHTML += `
                        <tr>
                            <td colspan="7" style="padding: 20px; text-align: center; color: #666; font-style: italic;">
                                ... e mais ${this.leads.length - 50} leads (mostrando apenas os primeiros 50)
                            </td>
                        </tr>
                    `;
                }
            }

            async handleAddLead(e) {
                e.preventDefault();
                
                const leadData = {
                    nome_completo: document.getElementById('leadName').value,
                    cpf: document.getElementById('leadCPF').value.replace(/[^\d]/g, ''),
                    email: document.getElementById('leadEmail').value,
                    telefone: document.getElementById('leadPhone').value,
                    produto: document.getElementById('leadProduct').value,
                    valor_total: parseFloat(document.getElementById('leadValue').value) || 0,
                    meio_pagamento: document.getElementById('leadPaymentMethod').value,
                    endereco: document.getElementById('leadAddress').value,
                    origem: 'direto',
                    etapa_atual: 1,
                    status_pagamento: 'pendente',
                    order_bumps: [],
                    produtos: [{
                        nome: document.getElementById('leadProduct').value,
                        preco: parseFloat(document.getElementById('leadValue').value) || 0
                    }],
                    id: Date.now().toString(),
                    created_at: new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };

                try {
                    this.leads.push(leadData);
                    localStorage.setItem('leads', JSON.stringify(this.leads));
                    
                    alert('Lead adicionado com sucesso!');
                    document.getElementById('addLeadForm').reset();
                    this.updateStats();
                    
                    console.log('‚úÖ Lead adicionado:', leadData);
                } catch (error) {
                    console.error('‚ùå Erro ao adicionar lead:', error);
                    alert('Erro ao adicionar lead: ' + error.message);
                }
            }

            previewBulkData() {
                const textarea = document.getElementById('bulkDataTextarea');
                const rawData = textarea?.value;

                if (!rawData || rawData.trim().length === 0) {
                    alert('Por favor, cole os dados da planilha no campo de texto.');
                    return;
                }

                console.log('üîç Iniciando an√°lise dos dados...');
                const parsedData = this.parseRawBulkData(rawData);

                if (!parsedData.success) {
                    alert(parsedData.error);
                    return;
                }

                console.log('‚úÖ Dados analisados:', parsedData);

                this.displayBulkPreview(parsedData);
                
                const previewSection = document.getElementById('bulkPreviewSection');
                const confirmButton = document.getElementById('confirmBulkImportButton');
                const previewSummary = document.getElementById('previewSummary');

                if (previewSection) previewSection.style.display = 'block';
                
                if (confirmButton && parsedData.leads.length > 0) {
                    confirmButton.style.display = 'inline-flex';
                    confirmButton.innerHTML = `<i class="fas fa-rocket"></i> Importar ${parsedData.leads.length} Registros`;
                    this.bulkImportData = parsedData.leads;
                }

                if (previewSummary) {
                    previewSummary.innerHTML = `
                        <i class="fas fa-info-circle"></i>
                        ${parsedData.leads.length} registros v√°lidos, 
                        ${parsedData.errors.length} erros
                    `;
                }
            }

            parseRawBulkData(rawData) {
                if (!rawData || !rawData.trim()) {
                    return {
                        success: false,
                        error: 'Nenhuma linha v√°lida encontrada nos dados colados.'
                    };
                }
                
                const lines = rawData.trim().split('\n').filter(line => line.trim());
                
                if (lines.length === 0) {
                    return {
                        success: false,
                        error: 'Nenhuma linha v√°lida encontrada nos dados colados.'
                    };
                }
                
                const leads = [];
                const parseErrors = [];
                const duplicatesInList = new Set();
                
                console.log(`üìã Total de linhas para processar: ${lines.length}`);
                
                const existingLeads = JSON.parse(localStorage.getItem('leads') || '[]');
                const existingCPFs = new Set(existingLeads.map(lead => 
                    lead.cpf ? lead.cpf.replace(/[^\d]/g, '') : ''
                ));

                for (let i = 0; i < lines.length; i++) {
                    try {
                        const line = lines[i].trim();
                        if (!line) continue;

                        let fields = [];
                        
                        if (line.includes('\t')) {
                            fields = line.split('\t');
                        } else if (line.includes('  ')) {
                            fields = line.split(/\s{2,}/);
                        } else {
                            fields = line.split(/\s+/);
                        }

                        fields = fields.map(field => field.trim()).filter(field => field.length > 0);

                        if (fields.length < 4) {
                            parseErrors.push({
                                line: i + 1,
                                error: `Poucos campos: ${fields.length}. M√≠nimo: 4`,
                                data: line
                            });
                            continue;
                        }

                        const [
                            nomeCompleto,
                            email,
                            telefone,
                            documento,
                            produto = 'Kit 12 caixas organizadoras + brinde',
                            valorTotal = '67.90',
                            endereco = '',
                            numero = '',
                            complemento = '',
                            bairro = '',
                            cep = '',
                            cidade = '',
                            estado = '',
                            pais = 'BR'
                        ] = fields;

                        if (!nomeCompleto || nomeCompleto.length < 2) {
                            parseErrors.push({
                                line: i + 1,
                                error: 'Nome √© obrigat√≥rio',
                                data: line
                            });
                            continue;
                        }

                        if (!email || !email.includes('@')) {
                            parseErrors.push({
                                line: i + 1,
                                error: 'Email inv√°lido',
                                data: line
                            });
                            continue;
                        }

                        const cleanCPF = documento ? documento.replace(/[^\d]/g, '') : '';
                        if (!cleanCPF || cleanCPF.length !== 11) {
                            parseErrors.push({
                                line: i + 1,
                                error: 'CPF deve ter 11 d√≠gitos',
                                data: line
                            });
                            continue;
                        }

                        if (duplicatesInList.has(cleanCPF) || existingCPFs.has(cleanCPF)) {
                            parseErrors.push({
                                line: i + 1,
                                error: 'CPF duplicado',
                                data: line
                            });
                            continue;
                        }
                        duplicatesInList.add(cleanCPF);

                        const valorProcessado = parseFloat(valorTotal.toString().replace(',', '.')) || 67.90;

                        const enderecoCompleto = [endereco, numero, complemento, bairro, cidade, estado, cep, pais]
                            .filter(part => part && part.trim())
                            .join(' - ') || 'Endere√ßo n√£o informado';

                        const leadData = {
                            nome_completo: nomeCompleto,
                            email: email,
                            telefone: telefone,
                            cpf: cleanCPF,
                            produto: produto,
                            valor_total: valorProcessado,
                            endereco: enderecoCompleto,
                            meio_pagamento: 'PIX',
                            origem: 'direto',
                            etapa_atual: 1,
                            status_pagamento: 'pendente',
                            lineNumber: i + 1,
                            id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                            created_at: new Date().toISOString(),
                            updated_at: new Date().toISOString()
                        };

                        leads.push(leadData);

                    } catch (error) {
                        parseErrors.push({
                            line: i + 1,
                            error: error.message,
                            data: lines[i]
                        });
                    }
                }

                return {
                    success: true,
                    leads: leads,
                    errors: parseErrors,
                    totalProcessed: lines.length
                };
            }

            displayBulkPreview(parsedData) {
                const previewContainer = document.getElementById('bulkPreviewContainer');
                if (!previewContainer) return;

                let tableHTML = `
                    <div style="max-height: 400px; overflow: auto; border: 1px solid #ddd; border-radius: 8px;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead style="background: #345C7A; color: white; position: sticky; top: 0;">
                                <tr>
                                    <th style="padding: 8px; border: 1px solid #ddd;">#</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">Nome</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">Email</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">Telefone</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">CPF</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">Produto</th>
                                    <th style="padding: 8px; border: 1px solid #ddd;">Valor</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                parsedData.leads.forEach((lead, index) => {
                    const rowColor = index % 2 === 0 ? '#f8f9fa' : '#ffffff';
                    const cpfFormatted = this.formatCPF(lead.cpf);
                    
                    tableHTML += `
                        <tr style="background: ${rowColor};">
                            <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${lead.lineNumber}</td>
                            <td style="padding: 6px; border: 1px solid #ddd;" title="${lead.nome_completo}">
                                ${this.truncateText(lead.nome_completo, 20)}
                            </td>
                            <td style="padding: 6px; border: 1px solid #ddd;" title="${lead.email}">
                                ${this.truncateText(lead.email, 25)}
                            </td>
                            <td style="padding: 6px; border: 1px solid #ddd;">${lead.telefone}</td>
                            <td style="padding: 6px; border: 1px solid #ddd;">${cpfFormatted}</td>
                            <td style="padding: 6px; border: 1px solid #ddd;" title="${lead.produto}">
                                ${this.truncateText(lead.produto, 30)}
                            </td>
                            <td style="padding: 6px; border: 1px solid #ddd; text-align: right;">
                                R$ ${lead.valor_total.toFixed(2)}
                            </td>
                        </tr>
                    `;
                });

                tableHTML += `</tbody></table></div>`;

                if (parsedData.errors.length > 0) {
                    tableHTML += `
                        <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px;">
                            <h5 style="color: #856404; margin-bottom: 10px;">
                                <i class="fas fa-exclamation-triangle"></i> 
                                Problemas Encontrados (${parsedData.errors.length})
                            </h5>
                            <div style="max-height: 150px; overflow-y: auto;">
                    `;

                    parsedData.errors.slice(0, 5).forEach(error => {
                        tableHTML += `
                            <div style="margin-bottom: 8px; padding: 8px; background: white; border-radius: 4px; border-left: 3px solid #dc3545;">
                                <strong>Linha ${error.line}:</strong> ${error.error}
                            </div>
                        `;
                    });

                    if (parsedData.errors.length > 5) {
                        tableHTML += `
                            <div style="text-align: center; color: #666; font-style: italic; margin-top: 10px;">
                                ... e mais ${parsedData.errors.length - 5} problemas
                            </div>
                        `;
                    }

                    tableHTML += `</div></div>`;
                }

                previewContainer.innerHTML = tableHTML;
            }

            async confirmBulkImport() {
                if (!this.bulkImportData || this.bulkImportData.length === 0) {
                    alert('Nenhum dado v√°lido para importar');
                    return;
                }

                console.log(`üöÄ Iniciando importa√ß√£o de ${this.bulkImportData.length} leads...`);
                
                this.showImportProgress();

                const results = { success: 0, errors: 0, total: this.bulkImportData.length };

                for (let i = 0; i < this.bulkImportData.length; i++) {
                    try {
                        const lead = this.bulkImportData[i];
                        
                        const existingLeads = JSON.parse(localStorage.getItem('leads') || '[]');
                        existingLeads.push(lead);
                        localStorage.setItem('leads', JSON.stringify(existingLeads));

                        results.success++;
                        console.log(`‚úÖ Lead ${i + 1}/${this.bulkImportData.length} importado: ${lead.nome_completo}`);

                    } catch (error) {
                        console.error(`‚ùå Erro ao importar lead ${i + 1}:`, error);
                        results.errors++;
                    }

                    this.updateImportProgress(i + 1, this.bulkImportData.length);
                    
                    if (i % 10 === 0) {
                        await new Promise(resolve => setTimeout(resolve, 50));
                    }
                }

                this.showImportResults(results);
                await this.loadLeads();
                this.updateStats();
                this.clearBulkData();
            }

            showImportProgress() {
                const resultsSection = document.getElementById('bulkResultsSection');
                const resultsContainer = document.getElementById('bulkResultsContainer');

                resultsSection.style.display = 'block';
                resultsContainer.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <div style="margin-bottom: 15px;">
                            <i class="fas fa-upload" style="font-size: 2rem; color: #345C7A; animation: pulse 1s infinite;"></i>
                        </div>
                        <h4 style="color: #345C7A; margin-bottom: 15px;">Importando Leads...</h4>
                        <div style="width: 100%; height: 20px; background: #e9ecef; border-radius: 10px; overflow: hidden; margin-bottom: 10px;">
                            <div id="importProgressFill" style="width: 0%; height: 100%; background: linear-gradient(45deg, #345C7A, #2c4a63); transition: width 0.3s ease;"></div>
                        </div>
                        <div id="importProgressText">0 / ${this.bulkImportData.length} leads processados</div>
                    </div>
                `;
            }

            updateImportProgress(current, total) {
                const progressFill = document.getElementById('importProgressFill');
                const progressText = document.getElementById('importProgressText');

                if (progressFill && progressText) {
                    const percentage = (current / total) * 100;
                    progressFill.style.width = `${percentage}%`;
                    progressText.textContent = `${current} / ${total} leads processados`;
                }
            }

            showImportResults(results) {
                const resultsContainer = document.getElementById('bulkResultsContainer');
                
                resultsContainer.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <div style="margin-bottom: 15px;">
                            <i class="fas fa-check-circle" style="font-size: 2rem; color: #27ae60;"></i>
                        </div>
                        <h4 style="color: #27ae60; margin-bottom: 15px;">Importa√ß√£o Conclu√≠da!</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                            <div style="padding: 15px; background: #d4edda; border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #155724;">${results.success}</div>
                                <div style="color: #155724;">Sucessos</div>
                            </div>
                            <div style="padding: 15px; background: #f8d7da; border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #721c24;">${results.errors}</div>
                                <div style="color: #721c24;">Erros</div>
                            </div>
                            <div style="padding: 15px; background: #cce5ff; border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #004085;">${results.total}</div>
                                <div style="color: #004085;">Total</div>
                            </div>
                        </div>
                        <button onclick="adminPanel.showView('leadsView')" style="
                            background: #345C7A; 
                            color: white; 
                            border: none; 
                            padding: 12px 25px; 
                            border-radius: 8px; 
                            cursor: pointer;
                            font-weight: 600;
                        ">
                            <i class="fas fa-list"></i> Ver Lista de Leads
                        </button>
                    </div>
                `;
            }

            clearBulkData() {
                const textarea = document.getElementById('bulkDataTextarea');
                const previewSection = document.getElementById('bulkPreviewSection');
                const resultsSection = document.getElementById('bulkResultsSection');

                if (textarea) textarea.value = '';
                if (previewSection) previewSection.style.display = 'none';
                if (resultsSection) resultsSection.style.display = 'none';

                this.bulkImportData = [];
                console.log('üßπ Dados limpos');
            }

            editBulkData() {
                const previewSection = document.getElementById('bulkPreviewSection');
                if (previewSection) previewSection.style.display = 'none';
                this.bulkImportData = [];
            }

            // Utility functions
            formatCPF(cpf) {
                const cleanCPF = cpf.replace(/[^\d]/g, '');
                return cleanCPF.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
            }

            applyCPFMask(input) {
                let value = input.value.replace(/[^\d]/g, '');
                
                if (value.length > 11) {
                    value = value.slice(0, 11);
                }
                
                if (value.length > 9) {
                    value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
                } else if (value.length > 6) {
                    value = value.replace(/(\d{3})(\d{3})(\d{3})/, '$1.$2.$3');
                } else if (value.length > 3) {
                    value = value.replace(/(\d{3})(\d{3})/, '$1.$2');
                }
                
                input.value = value;
                return value;
            }

            truncateText(text, maxLength) {
                if (!text) return '';
                return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
            }

            formatDate(dateString) {
                if (!dateString) return 'N/A';
                return new Date(dateString).toLocaleDateString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        // Inicializar painel quando DOM estiver pronto
        document.addEventListener('DOMContentLoaded', () => {
            window.adminPanel = new AdminPanel();
            console.log('‚úÖ Painel administrativo inicializado');
        });
    </script>
</body>
</html>